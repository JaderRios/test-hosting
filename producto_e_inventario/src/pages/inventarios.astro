---
import '../styles/global.css';
import Dashboard from '../components/Dashboard.astro';
import AgregarInventario from '../components/agregar/AgregarInventario.astro';
import EditarInventario from '../components/editar/EditarInventario.astro';
const res = await fetch('http://localhost:8080/inventarios');
const data = await res.json();
const inventarios = data as { idInventario: number; idProducto: number; cantidad: number; ubicacion: string }[];
---

<Dashboard>
  <section class='py-12 min-h-screen font-poppins'>
    <div class='max-w-4xl mx-auto px-4 sm:px-6 lg:px-8'>
      <h1 class='text-3xl font-bold text-gray-800 mb-6 text-center'>Listado de Inventarios</h1>
      <AgregarInventario />
      <div class='overflow-x-auto bg-white rounded-xl shadow-md mt-10'>
        <table class='w-full text-sm text-left text-gray-700'>
          <thead class='text-xs uppercase bg-indigo-100 text-indigo-700'>
            <tr>
              <th class='px-6 py-3'>ID Inventario</th>
              <th class='px-6 py-3'>ID Producto</th>
              <th class='px-6 py-3'>Cantidad</th>
              <th class='px-6 py-3'>Ubicacion</th>
              <th class='px-6 py-3'>Acciones</th>
            </tr>
          </thead>
          <tbody>
            {
              inventarios.map(inventario => (
                <tr class='border-b hover:bg-indigo-50 transition-colors duration-200'>
                  <td class='px-6 py-4'>{inventario.idInventario}</td>
                  <td class='px-6 py-4'>{inventario.idProducto}</td>
                  <td class='px-6 py-4'>{inventario.cantidad} unidades</td>
                  <td class='px-6 py-4'>{inventario.ubicacion}</td>
                  <td class='px-6 py-4 space-x-2'>
                    <EditarInventario inventario={inventario} />
                    <button
                      class='bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 eliminar-btn'
                      data-id={inventario.idInventario}
                    >
                      Eliminar
                    </button>
                  </td>
                </tr>
              ))
            }
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <script is:inline>
    document.addEventListener('DOMContentLoaded', () => {
      const botonesEliminar = document.querySelectorAll('.eliminar-btn');
      botonesEliminar.forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-id');
          fetch(`http://localhost:8080/inventarios/${id}`, {
            method: 'DELETE'
          })
            .then(response => {
              if (response.ok) {
                alert('Inventario eliminado correctamente');
                location.reload();
              } else {
                alert('Error al eliminar el inventario');
              }
            })
            .catch(error => {
              console.error('Error:', error);
              alert('Error en la solicitud');
            });
        });
      });
    });
  </script>
</Dashboard>
