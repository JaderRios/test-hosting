---
import '../styles/global.css';
import AgregarProducto from '../components/agregar/AgregarProducto.astro';
import Dashboard from '../components/Dashboard.astro';
import EditarProducto from '../components/editar/EditarProducto.astro';
const data = [];
const productos = data as { idProducto: number; nombre: string; precio: number }[];
---

<Dashboard>
  <section class='py-12 min-h-screen font-poppins'>
    <div class='max-w-4xl mx-auto px-4 sm:px-6 lg:px-8'>
      <h1 class='text-3xl font-bold text-gray-800 mb-6 text-center'>Listado de Productos</h1>
      <AgregarProducto />
      <div class='overflow-x-auto bg-white rounded-xl shadow-md mt-10'>
        <table class='w-full text-sm text-left text-gray-700'>
          <thead class='text-xs uppercase bg-indigo-100 text-indigo-700'>
            <tr>
              <th class='px-6 py-3'>Nombre</th>
              <th class='px-6 py-3'>Precio</th>
              <th class='px-6 py-3'>Acciones</th>
            </tr>
          </thead>
          <tbody>
            {
              productos.map(producto => (
                <tr class='border-b hover:bg-indigo-50 transition-colors duration-200'>
                  <td class='px-6 py-4'>{producto.nombre.charAt(0).toUpperCase() + producto.nombre.slice(1)}</td>
                  <td class='px-6 py-4'>S/.{producto.precio.toFixed(2)}</td>
                  <td class='px-6 py-4 space-x-2'>
                    <EditarProducto producto={producto} />
                    <button
                      class='bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 eliminar-btn'
                      data-id={producto.idProducto}
                    >
                      Eliminar
                    </button>
                  </td>
                </tr>
              ))
            }
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <script is:inline>
    document.addEventListener('DOMContentLoaded', () => {
      const botonesEliminar = document.querySelectorAll('.eliminar-btn');
      botonesEliminar.forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-id');
          fetch(`http://localhost:8080/productos/${id}`, {
            method: 'DELETE'
          })
            .then(response => {
              if (response.ok) {
                alert('Producto eliminado correctamente');
                location.reload();
              } else {
                alert('Error al eliminar el producto');
              }
            })
            .catch(error => {
              console.error('Error:', error);
              alert('Error en la solicitud');
            });
        });
      });
    });
  </script>
</Dashboard>
