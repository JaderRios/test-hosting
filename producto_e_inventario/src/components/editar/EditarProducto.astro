---
// Opcional: props si los necesitas
const { producto } = Astro.props || {};
---

<!-- Botón para abrir el modal -->
<button
  type='button'
  class='px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600'
  onclick={`abrirModalEditarProducto(${JSON.stringify(producto)})`}
>
  Editar
</button>
<div id='modal-editar-producto' class='hidden fixed inset-0 bg-black opacity-90 flex items-center justify-center z-50'>
  <div class='bg-white p-6 rounded-lg shadow-lg w-96 relative'>
    <button
      id='btn-cerrar-modal-editar-producto'
      class='absolute top-2 right-2 text-gray-400 hover:text-black text-2xl'
    >
      &times;
    </button>
    <h2 class='text-xl font-bold mb-4 text-center'>Editar Producto</h2>
    <form id='form-editar-producto' class='space-y-4'>
      <input type='hidden' name='idProducto' id='edit-prod-id' />
      <input
        type='text'
        name='nombre'
        id='edit-prod-nombre'
        placeholder='Nombre del producto'
        required
        class='w-full border p-2 rounded'
      />
      <input
        type='number'
        step='0.01'
        name='precio'
        id='edit-prod-precio'
        placeholder='Precio'
        required
        class='w-full border p-2 rounded'
      />
      <div class='flex justify-end gap-2'>
        <button type='button' id='btn-cancelar-editar-producto' class='px-4 py-2 bg-gray-300 rounded hover:bg-gray-400'
          >Cancelar</button
        >
        <button type='submit' class='px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700'>Guardar Cambios</button
        >
      </div>
    </form>
  </div>
</div>

<script is:inline>
  const modalEditarProd = document.getElementById('modal-editar-producto');
  const cerrarEditarProdBtn = document.getElementById('btn-cerrar-modal-editar-producto');
  const cancelarEditarProdBtn = document.getElementById('btn-cancelar-editar-producto');
  const formEditarProd = document.getElementById('form-editar-producto');

  // Función global para llenar y mostrar el modal
  window.abrirModalEditarProducto = producto => {
    document.getElementById('edit-prod-id').value = producto.idProducto;
    document.getElementById('edit-prod-nombre').value = producto.nombre;
    document.getElementById('edit-prod-precio').value = producto.precio;
    modalEditarProd.classList.remove('hidden');
  };

  cerrarEditarProdBtn.addEventListener('click', () => {
    modalEditarProd.classList.add('hidden');
  });

  cancelarEditarProdBtn.addEventListener('click', () => {
    modalEditarProd.classList.add('hidden');
  });

  formEditarProd.addEventListener('submit', async e => {
    e.preventDefault();
    const id = document.getElementById('edit-prod-id').value;
    const nombre = document.getElementById('edit-prod-nombre').value;
    const precio = document.getElementById('edit-prod-precio').value;

    const response = await fetch(`http://localhost:8080/productos/${id}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ idProducto: id, nombre, precio })
    });

    if (response.ok) {
      alert('Producto actualizado');
      location.reload();
    } else {
      alert('Error al actualizar producto');
    }
  });
</script>
